<VirtualHost *:80>
    ServerName portal.northem.no
    ServerAdmin admin@northem.no

    # Enable necessary Apache modules for proxying
    # Run these commands first:
    # sudo a2enmod proxy
    # sudo a2enmod proxy_http
    # sudo a2enmod rewrite
    # sudo systemctl reload apache2

    # Proxy configuration
    ProxyPreserveHost On
    ProxyPass / http://localhost:3000/
    ProxyPassReverse / http://localhost:3000/

    # WebSocket support (for real-time features)
    ProxyPass /ws ws://localhost:3000/ws
    ProxyPassReverse /ws ws://localhost:3000/ws

    # Rewrite rules for clean URLs
    <Directory /var/www/html>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/portal.northem.no-error.log
    CustomLog ${APACHE_LOG_DIR}/portal.northem.no-access.log combined

    # Performance optimizations
    <IfModule mod_headers.c>
        Header set Connection keep-alive
        Header set X-Frame-Options "SAMEORIGIN"
        Header set X-Content-Type-Options "nosniff"
        Header set X-XSS-Protection "1; mode=block"
    </IfModule>
</VirtualHost>

# Redirect HTTP to HTTPS (optional, uncomment after setting up SSL)
# <VirtualHost *:80>
#     ServerName portal.northem.no
#     Redirect permanent / https://portal.northem.no/
# </VirtualHost>

# HTTPS configuration (set up with Let's Encrypt)
# <VirtualHost *:443>
#     ServerName portal.northem.no
#     ServerAdmin admin@northem.no
#
#     SSLEngine on
#     SSLCertificateFile /etc/letsencrypt/live/portal.northem.no/fullchain.pem
#     SSLCertificateKeyFile /etc/letsencrypt/live/portal.northem.no/privkey.pem
#
#     ProxyPreserveHost On
#     ProxyPass / http://localhost:3000/
#     ProxyPassReverse / http://localhost:3000/
#
#     ProxyPass /ws ws://localhost:3000/ws
#     ProxyPassReverse /ws ws://localhost:3000/ws
#
#     ErrorLog ${APACHE_LOG_DIR}/portal.northem.no-error.log
#     CustomLog ${APACHE_LOG_DIR}/portal.northem.no-access.log combined
# </VirtualHost>
