{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/sondrey/Downloads/v0-teaterplattform-utviklingsplan-main%202/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\"\nimport { createClient } from \"@supabase/supabase-js\"\nimport { cookies } from \"next/headers\"\n\nexport async function getSupabaseServerClient() {\n  const cookieStore = await cookies()\n\n  return createServerClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!, {\n    cookies: {\n      getAll() {\n        return cookieStore.getAll()\n      },\n      setAll(cookiesToSet) {\n        try {\n          cookiesToSet.forEach(({ name, value, options }) => cookieStore.set(name, value, options))\n        } catch {\n          // Server Component - ignore\n        }\n      },\n    },\n  })\n}\n\nexport async function getSupabaseAdminClient() {\n  // Use createClient with service role key to bypass RLS\n  // Do NOT use createServerClient with service role key - it still respects RLS\n  return createClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.SUPABASE_SERVICE_ROLE_KEY!, {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false,\n    },\n  })\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AACA;;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,OAAO,IAAA,iMAAkB,sUAAoF;QAC3G,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAK,YAAY,GAAG,CAAC,MAAM,OAAO;gBAClF,EAAE,OAAM;gBACN,4BAA4B;gBAC9B;YACF;QACF;IACF;AACF;AAEO,eAAe;IACpB,uDAAuD;IACvD,8EAA8E;IAC9E,OAAO,IAAA,yLAAY,gFAAwC,QAAQ,GAAG,CAAC,yBAAyB,EAAG;QACjG,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AACF"}},
    {"offset": {"line": 90, "column": 0}, "map": {"version":3,"sources":["file:///Users/sondrey/Downloads/v0-teaterplattform-utviklingsplan-main%202/app/api/purchases/create/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\nimport { getSupabaseServerClient, getSupabaseAdminClient } from \"@/lib/supabase/server\"\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { ensembleId, recordingIds, team, amount } = body\n\n    if (!ensembleId || !recordingIds || !amount) {\n      return NextResponse.json({ error: \"Manglende påkrevde felt\" }, { status: 400 })\n    }\n\n    const supabase = await getSupabaseServerClient()\n\n    // Get current user\n    const {\n      data: { user },\n    } = await supabase.auth.getUser()\n\n    if (!user) {\n      return NextResponse.json({ error: \"Du må være logget inn\" }, { status: 401 })\n    }\n\n    const adminSupabase = await getSupabaseAdminClient()\n\n    // Check if user already has this purchase\n    const { data: existingPurchase } = await adminSupabase\n      .from(\"purchases\")\n      .select(\"id\")\n      .eq(\"user_id\", user.id)\n      .eq(\"ensemble_id\", ensembleId)\n      .eq(\"status\", \"completed\")\n      .single()\n\n    if (existingPurchase) {\n      return NextResponse.json({ error: \"Du har allerede kjøpt dette opptaket\" }, { status: 400 })\n    }\n\n    // Create purchase (mock payment - directly completed)\n    const { data: purchase, error: purchaseError } = await adminSupabase\n      .from(\"purchases\")\n      .insert({\n        user_id: user.id,\n        ensemble_id: ensembleId,\n        recording_ids: recordingIds,\n        amount_paid_nok: amount,\n        status: \"completed\",\n        access_granted_at: new Date().toISOString(),\n      })\n      .select()\n      .single()\n\n    if (purchaseError) {\n      console.error(\"[v0] Purchase error:\", purchaseError)\n      return NextResponse.json({ error: \"Kunne ikke opprette kjøp: \" + purchaseError.message }, { status: 500 })\n    }\n\n    return NextResponse.json({\n      success: true,\n      purchaseId: purchase.id,\n    })\n  } catch (error) {\n    console.error(\"[v0] Purchase creation error:\", error)\n    return NextResponse.json({ error: \"Intern serverfeil\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,UAAU,EAAE,YAAY,EAAE,IAAI,EAAE,MAAM,EAAE,GAAG;QAEnD,IAAI,CAAC,cAAc,CAAC,gBAAgB,CAAC,QAAQ;YAC3C,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA0B,GAAG;gBAAE,QAAQ;YAAI;QAC/E;QAEA,MAAM,WAAW,MAAM,IAAA,sJAAuB;QAE9C,mBAAmB;QACnB,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QAE/B,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAwB,GAAG;gBAAE,QAAQ;YAAI;QAC7E;QAEA,MAAM,gBAAgB,MAAM,IAAA,qJAAsB;QAElD,0CAA0C;QAC1C,MAAM,EAAE,MAAM,gBAAgB,EAAE,GAAG,MAAM,cACtC,IAAI,CAAC,aACL,MAAM,CAAC,MACP,EAAE,CAAC,WAAW,KAAK,EAAE,EACrB,EAAE,CAAC,eAAe,YAClB,EAAE,CAAC,UAAU,aACb,MAAM;QAET,IAAI,kBAAkB;YACpB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAuC,GAAG;gBAAE,QAAQ;YAAI;QAC5F;QAEA,sDAAsD;QACtD,MAAM,EAAE,MAAM,QAAQ,EAAE,OAAO,aAAa,EAAE,GAAG,MAAM,cACpD,IAAI,CAAC,aACL,MAAM,CAAC;YACN,SAAS,KAAK,EAAE;YAChB,aAAa;YACb,eAAe;YACf,iBAAiB;YACjB,QAAQ;YACR,mBAAmB,IAAI,OAAO,WAAW;QAC3C,GACC,MAAM,GACN,MAAM;QAET,IAAI,eAAe;YACjB,QAAQ,KAAK,CAAC,wBAAwB;YACtC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,+BAA+B,cAAc,OAAO;YAAC,GAAG;gBAAE,QAAQ;YAAI;QAC1G;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,YAAY,SAAS,EAAE;QACzB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAoB,GAAG;YAAE,QAAQ;QAAI;IACzE;AACF"}}]
}