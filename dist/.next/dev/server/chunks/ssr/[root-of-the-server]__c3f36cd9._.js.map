{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 14, "column": 0}, "map": {"version":3,"sources":["file:///Users/sondrey/Downloads/v0-teaterplattform-utviklingsplan-main%202/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\"\nimport { createClient } from \"@supabase/supabase-js\"\nimport { cookies } from \"next/headers\"\n\nexport async function getSupabaseServerClient() {\n  const cookieStore = await cookies()\n\n  return createServerClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!, {\n    cookies: {\n      getAll() {\n        return cookieStore.getAll()\n      },\n      setAll(cookiesToSet) {\n        try {\n          cookiesToSet.forEach(({ name, value, options }) => cookieStore.set(name, value, options))\n        } catch {\n          // Server Component - ignore\n        }\n      },\n    },\n  })\n}\n\nexport async function getSupabaseAdminClient() {\n  // Use createClient with service role key to bypass RLS\n  // Do NOT use createServerClient with service role key - it still respects RLS\n  return createClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.SUPABASE_SERVICE_ROLE_KEY!, {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false,\n    },\n  })\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AACA;;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IAEjC,OAAO,IAAA,+LAAkB,sUAAoF;QAC3G,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAK,YAAY,GAAG,CAAC,MAAM,OAAO;gBAClF,EAAE,OAAM;gBACN,4BAA4B;gBAC9B;YACF;QACF;IACF;AACF;AAEO,eAAe;IACpB,uDAAuD;IACvD,8EAA8E;IAC9E,OAAO,IAAA,uLAAY,gFAAwC,QAAQ,GAAG,CAAC,yBAAyB,EAAG;QACjG,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AACF"}},
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/sondrey/Downloads/v0-teaterplattform-utviklingsplan-main%202/components/video/secure-video-player.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const SecureVideoPlayer = registerClientReference(\n    function() { throw new Error(\"Attempted to call SecureVideoPlayer() from the server but SecureVideoPlayer is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/video/secure-video-player.tsx <module evaluation>\",\n    \"SecureVideoPlayer\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,oBAAoB,IAAA,wQAAuB,EACpD;IAAa,MAAM,IAAI,MAAM;AAAkP,GAC/Q,0EACA","ignoreList":[0]}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///Users/sondrey/Downloads/v0-teaterplattform-utviklingsplan-main%202/components/video/secure-video-player.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const SecureVideoPlayer = registerClientReference(\n    function() { throw new Error(\"Attempted to call SecureVideoPlayer() from the server but SecureVideoPlayer is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/video/secure-video-player.tsx\",\n    \"SecureVideoPlayer\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,oBAAoB,IAAA,wQAAuB,EACpD;IAAa,MAAM,IAAI,MAAM;AAAkP,GAC/Q,sDACA","ignoreList":[0]}},
    {"offset": {"line": 86, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///Users/sondrey/Downloads/v0-teaterplattform-utviklingsplan-main%202/app/se/%5BrecordingId%5D/page.tsx"],"sourcesContent":["import { redirect, notFound } from \"next/navigation\"\nimport { getSupabaseServerClient, getSupabaseAdminClient } from \"@/lib/supabase/server\"\nimport { SecureVideoPlayer } from \"@/components/video/secure-video-player\"\n\nexport const dynamic = \"force-dynamic\"\n\nasync function verifyAccess(userId: string, recordingId: string) {\n  const supabase = await getSupabaseAdminClient()\n\n  // Get recording and its ensemble\n  const { data: recording, error: recordingError } = await supabase\n    .from(\"recordings\")\n    .select(\"*, ensemble:ensembles(*)\")\n    .eq(\"id\", recordingId)\n    .single()\n\n  if (recordingError || !recording) {\n    return { hasAccess: false, recording: null }\n  }\n\n  // Check if user has purchased access\n  const { data: purchase } = await supabase\n    .from(\"purchases\")\n    .select(\"*\")\n    .eq(\"user_id\", userId)\n    .eq(\"ensemble_id\", recording.ensemble_id)\n    .eq(\"status\", \"completed\")\n    .single()\n\n  if (!purchase) {\n    return { hasAccess: false, recording }\n  }\n\n  // Check if access has expired\n  if (purchase.access_expires_at && new Date(purchase.access_expires_at) < new Date()) {\n    return { hasAccess: false, recording }\n  }\n\n  return { hasAccess: true, recording }\n}\n\nasync function createAccessToken(userId: string, recordingId: string, request: Request) {\n  const supabase = await getSupabaseAdminClient()\n\n  // Generate a unique token\n  const token = crypto.randomUUID() + \"-\" + Date.now()\n\n  // Token expires in 4 hours\n  const expiresAt = new Date(Date.now() + 4 * 60 * 60 * 1000)\n\n  // Get user agent and attempt to get IP\n  const userAgent = request.headers.get(\"user-agent\") || \"\"\n  const forwardedFor = request.headers.get(\"x-forwarded-for\")\n  const ipAddress = forwardedFor ? forwardedFor.split(\",\")[0].trim() : \"unknown\"\n\n  await supabase.from(\"video_access_tokens\").insert({\n    user_id: userId,\n    recording_id: recordingId,\n    token,\n    expires_at: expiresAt.toISOString(),\n    ip_address: ipAddress,\n    user_agent: userAgent,\n  })\n\n  return token\n}\n\nexport default async function WatchRecordingPage({\n  params,\n}: {\n  params: Promise<{ recordingId: string }>\n}) {\n  const { recordingId } = await params\n  const supabase = await getSupabaseServerClient()\n\n  const {\n    data: { user },\n  } = await supabase.auth.getUser()\n\n  if (!user) {\n    redirect(`/logg-inn?redirect=/se/${recordingId}`)\n  }\n\n  const { hasAccess, recording } = await verifyAccess(user.id, recordingId)\n\n  if (!recording) {\n    notFound()\n  }\n\n  if (!hasAccess) {\n    redirect(`/ensemble/${recording.ensemble?.slug || recording.ensemble_id}?buy=true`)\n  }\n\n  // Create a time-limited access token\n  const request = new Request(\"https://placeholder.com\")\n  const accessToken = await createAccessToken(user.id, recordingId, request)\n\n  return (\n    <main className=\"min-h-screen bg-black\">\n      <SecureVideoPlayer\n        recordingId={recordingId}\n        accessToken={accessToken}\n        title={recording.ensemble?.title || \"Opptak\"}\n        team={recording.team}\n        description={recording.description}\n      />\n    </main>\n  )\n}\n"],"names":[],"mappings":";;;;;;;AAAA;AAAA;AACA;AACA;;;;;AAEO,MAAM,UAAU;AAEvB,eAAe,aAAa,MAAc,EAAE,WAAmB;IAC7D,MAAM,WAAW,MAAM,IAAA,mJAAsB;IAE7C,iCAAiC;IACjC,MAAM,EAAE,MAAM,SAAS,EAAE,OAAO,cAAc,EAAE,GAAG,MAAM,SACtD,IAAI,CAAC,cACL,MAAM,CAAC,4BACP,EAAE,CAAC,MAAM,aACT,MAAM;IAET,IAAI,kBAAkB,CAAC,WAAW;QAChC,OAAO;YAAE,WAAW;YAAO,WAAW;QAAK;IAC7C;IAEA,qCAAqC;IACrC,MAAM,EAAE,MAAM,QAAQ,EAAE,GAAG,MAAM,SAC9B,IAAI,CAAC,aACL,MAAM,CAAC,KACP,EAAE,CAAC,WAAW,QACd,EAAE,CAAC,eAAe,UAAU,WAAW,EACvC,EAAE,CAAC,UAAU,aACb,MAAM;IAET,IAAI,CAAC,UAAU;QACb,OAAO;YAAE,WAAW;YAAO;QAAU;IACvC;IAEA,8BAA8B;IAC9B,IAAI,SAAS,iBAAiB,IAAI,IAAI,KAAK,SAAS,iBAAiB,IAAI,IAAI,QAAQ;QACnF,OAAO;YAAE,WAAW;YAAO;QAAU;IACvC;IAEA,OAAO;QAAE,WAAW;QAAM;IAAU;AACtC;AAEA,eAAe,kBAAkB,MAAc,EAAE,WAAmB,EAAE,OAAgB;IACpF,MAAM,WAAW,MAAM,IAAA,mJAAsB;IAE7C,0BAA0B;IAC1B,MAAM,QAAQ,OAAO,UAAU,KAAK,MAAM,KAAK,GAAG;IAElD,2BAA2B;IAC3B,MAAM,YAAY,IAAI,KAAK,KAAK,GAAG,KAAK,IAAI,KAAK,KAAK;IAEtD,uCAAuC;IACvC,MAAM,YAAY,QAAQ,OAAO,CAAC,GAAG,CAAC,iBAAiB;IACvD,MAAM,eAAe,QAAQ,OAAO,CAAC,GAAG,CAAC;IACzC,MAAM,YAAY,eAAe,aAAa,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,KAAK;IAErE,MAAM,SAAS,IAAI,CAAC,uBAAuB,MAAM,CAAC;QAChD,SAAS;QACT,cAAc;QACd;QACA,YAAY,UAAU,WAAW;QACjC,YAAY;QACZ,YAAY;IACd;IAEA,OAAO;AACT;AAEe,eAAe,mBAAmB,EAC/C,MAAM,EAGP;IACC,MAAM,EAAE,WAAW,EAAE,GAAG,MAAM;IAC9B,MAAM,WAAW,MAAM,IAAA,oJAAuB;IAE9C,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAE/B,IAAI,CAAC,MAAM;QACT,IAAA,iMAAQ,EAAC,CAAC,uBAAuB,EAAE,aAAa;IAClD;IAEA,MAAM,EAAE,SAAS,EAAE,SAAS,EAAE,GAAG,MAAM,aAAa,KAAK,EAAE,EAAE;IAE7D,IAAI,CAAC,WAAW;QACd,IAAA,iMAAQ;IACV;IAEA,IAAI,CAAC,WAAW;QACd,IAAA,iMAAQ,EAAC,CAAC,UAAU,EAAE,UAAU,QAAQ,EAAE,QAAQ,UAAU,WAAW,CAAC,SAAS,CAAC;IACpF;IAEA,qCAAqC;IACrC,MAAM,UAAU,IAAI,QAAQ;IAC5B,MAAM,cAAc,MAAM,kBAAkB,KAAK,EAAE,EAAE,aAAa;IAElE,qBACE,8OAAC;QAAK,WAAU;kBACd,cAAA,8OAAC,sKAAiB;YAChB,aAAa;YACb,aAAa;YACb,OAAO,UAAU,QAAQ,EAAE,SAAS;YACpC,MAAM,UAAU,IAAI;YACpB,aAAa,UAAU,WAAW;;;;;;;;;;;AAI1C"}}]
}