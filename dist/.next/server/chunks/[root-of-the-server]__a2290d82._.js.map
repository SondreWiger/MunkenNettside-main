{"version":3,"sources":["../../../lib/utils/booking.ts"],"sourcesContent":["import crypto from \"crypto\"\n\nconst QR_SECRET = process.env.QR_SIGNING_SECRET || \"default-secret-change-in-production\"\n\nexport function generateBookingReference(): string {\n  const date = new Date()\n  const dateStr = date.toISOString().slice(0, 10).replace(/-/g, \"\")\n  const randomPart = crypto.randomBytes(2).toString(\"hex\").toUpperCase()\n  return `THTR-${dateStr}-${randomPart}`\n}\n\nexport function generateQRSignature(data: object): string {\n  const payload = JSON.stringify(data)\n  return crypto.createHmac(\"sha256\", QR_SECRET).update(payload).digest(\"hex\")\n}\n\nexport function verifyQRSignature(data: object, signature: string): boolean {\n  const expectedSignature = generateQRSignature(data)\n  return crypto.timingSafeEqual(Buffer.from(signature), Buffer.from(expectedSignature))\n}\n\nexport function createQRCodeData(\n  bookingId: string,\n  reference: string,\n  showId: string,\n  showTitle: string,\n  showDatetime: string,\n  customerName: string,\n  seats: Array<{ section: string; row: string; number: number }>,\n) {\n  const dataWithoutSignature = {\n    booking_id: bookingId,\n    reference,\n    show_id: showId,\n    show_title: showTitle,\n    show_datetime: showDatetime,\n    customer_name: customerName,\n    seats,\n    checked_in: false,\n  }\n\n  const signature = generateQRSignature(dataWithoutSignature)\n\n  return {\n    ...dataWithoutSignature,\n    signature,\n  }\n}\n\nexport function formatPrice(amount: number): string {\n  return new Intl.NumberFormat(\"nb-NO\", {\n    style: \"currency\",\n    currency: \"NOK\",\n    minimumFractionDigits: 0,\n    maximumFractionDigits: 0,\n  }).format(amount)\n}\n\nexport function formatDate(dateString: string): string {\n  return new Intl.DateTimeFormat(\"nb-NO\", {\n    weekday: \"long\",\n    year: \"numeric\",\n    month: \"long\",\n    day: \"numeric\",\n  }).format(new Date(dateString))\n}\n\nexport function formatTime(dateString: string): string {\n  return new Intl.DateTimeFormat(\"nb-NO\", {\n    hour: \"2-digit\",\n    minute: \"2-digit\",\n  }).format(new Date(dateString))\n}\n\nexport function formatDateTime(dateString: string): string {\n  return `${formatDate(dateString)} kl. ${formatTime(dateString)}`\n}\n"],"names":[],"mappings":"w1CAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAEA,IAAM,EAAY,QAAQ,GAAG,CAAC,iBAAiB,EAAI,sCAE5C,SAAS,IAEd,IAAM,EADO,AACG,IADC,OACI,WAAW,GAAG,KAAK,CAAC,EAAG,IAAI,OAAO,CAAC,KAAM,IACxD,EAAa,EAAA,OAAM,CAAC,WAAW,CAAC,GAAG,QAAQ,CAAC,OAAO,WAAW,GACpE,MAAO,CAAC,KAAK,EAAE,EAAQ,CAAC,EAAE,EAAA,CAAY,AACxC,CAEO,SAAS,EAAoB,CAAY,EAC9C,IAAM,EAAU,KAAK,SAAS,CAAC,GAC/B,OAAO,EAAA,OAAM,CAAC,UAAU,CAAC,SAAU,GAAW,MAAM,CAAC,GAAS,MAAM,CAAC,MACvE,CAEO,SAAS,EAAkB,CAAY,CAAE,CAAiB,EAC/D,IAAM,EAAoB,EAAoB,GAC9C,OAAO,EAAA,OAAM,CAAC,eAAe,CAAC,OAAO,IAAI,CAAC,GAAY,OAAO,IAAI,CAAC,GACpE,CAEO,SAAS,EACd,CAAiB,CACjB,CAAiB,CACjB,CAAc,CACd,CAAiB,CACjB,CAAoB,CACpB,CAAoB,CACpB,CAA8D,EAE9D,IAAM,EAAuB,CAC3B,WAAY,EACZ,YACA,QAAS,EACT,WAAY,EACZ,cAAe,EACf,cAAe,QACf,EACA,YAAY,CACd,EAEM,EAAY,EAAoB,GAEtC,MAAO,CACL,GAAG,CAAoB,WACvB,CACF,CACF,CAEO,SAAS,EAAY,CAAc,EACxC,OAAO,IAAI,KAAK,YAAY,CAAC,QAAS,CACpC,MAAO,WACP,SAAU,MACV,sBAAuB,EACvB,sBAAuB,CACzB,GAAG,MAAM,CAAC,EACZ,CAEO,SAAS,EAAW,CAAkB,EAC3C,OAAO,IAAI,KAAK,cAAc,CAAC,QAAS,CACtC,QAAS,OACT,KAAM,UACN,MAAO,OACP,IAAK,SACP,GAAG,MAAM,CAAC,IAAI,KAAK,GACrB,CAEO,SAAS,EAAW,CAAkB,EAC3C,OAAO,IAAI,KAAK,cAAc,CAAC,QAAS,CACtC,KAAM,UACN,OAAQ,SACV,GAAG,MAAM,CAAC,IAAI,KAAK,GACrB"}